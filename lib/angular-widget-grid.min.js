/**
 * @license angular-widget-grid v0.1.0
 * (c) 2015 Patrick Buergin
 * License: MIT
 * https://github.com/patbuergin/angular-widget-grid
 */

!function(){angular.module("widgetGrid",[])}(),function(){function a(){return{scope:{columns:"@",rows:"@"},restrict:"AE",controller:"wgGridController",controllerAs:"gridCtrl",transclude:!0,replace:!0,templateUrl:"wg-grid"}}angular.module("widgetGrid").controller("wgGridController",["$attrs","$element","$scope","Grid","gridRenderer",function(a,b,c,d,e){function f(a){p.grid.add(a),i()}function g(a){p.grid.remove(a),i()}function h(){var a=parseInt(c.columns),b=parseInt(c.rows);(p.grid.columns!==a||p.grid.rows!==b)&&(p.grid.resize(b,a),i())}function i(){q=e.render(p.grid),c.$broadcast("rendering-finished")}function j(a){q.updateWidget(a)}function k(a){return q.getStyle(a.id)}function l(){return{top:b[0].offsetTop,left:b[0].offsetLeft,height:b[0].clientHeight,width:b[0].clientWidth}}function m(a,b,c){return q?q.isObstructed(a,b,c):!0}function n(a,b,c,d){return q?q.isAreaObstructed(a,b,c,d):!0}function o(a,c){return q.rasterizeCoords(a,c,b[0].clientWidth,b[0].clientHeight)}var p=this,q=null,r={columns:c.columns,rows:c.rows};p.grid=new d(r),p.addWidget=f,p.removeWidget=g,p.updateGridSize=h,p.updateRendering=i,p.getPositions=l,p.rasterizeCoords=o,p.updateWidget=j,p.getWidgetStyle=k,p.isPositionObstructed=m,p.isAreaObstructed=n,c.$watch("columns",h),c.$watch("rows",h)}]),angular.module("widgetGrid").directive("wgGrid",a)}(),function(){angular.module("widgetGrid").directive("wgMovable",["gridUtil",function(a){return{restrict:"A",require:"wgWidget",link:{pre:function(b,c,d,e){var f=a.getTemplate("wg-movable");if(f){var g=angular.element(f);c.append(g),e.innerCompile(g)}}}}}]),angular.module("widgetGrid").directive("wgMover",["$document","gridUtil",function(a,b){return{restrict:"A",require:"^wgGrid",link:function(c,d,e,f){function g(e){function g(a){a.preventDefault(),a.touches&&(a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY);var b=a.clientX-o.left,c=a.clientY-o.top;m.top=Math.min(Math.max(c-n.top,0),o.height-1),m.left=Math.min(Math.max(b-n.left,0),o.width-1),j.css({top:m.top+"px",left:m.left+"px"})}function h(d){d.preventDefault(),a.off("mousemove touchmove",g),a.off("mouseup touchend touchcancel",h);for(var e,i=f.rasterizeCoords(m.left,m.top),l={top:i.i,left:i.j},n=l.top>=k.top,o=l.left>=k.left,p=b.getPathIterator(k,l);p.hasNext();){var q=p.next(),r={top:q.top,left:q.left,height:k.height,width:k.width},s=f.isAreaObstructed(r,k,n,o);if(!s){e=q;break}}j.removeClass("wg-moving"),c.setWidgetPosition(e)}e.preventDefault();var i=d[0].parentElement,j=angular.element(i);j.addClass("wg-moving");var k={};k.top=c.widget.top,k.left=c.widget.left,k.height=c.widget.height,k.width=c.widget.width,k.bottom=k.top+k.height-1,k.right=k.left+k.width-1;var l={};l.top=i.offsetTop,l.left=i.offsetLeft,e.offsetX=e.offsetX||e.layerX,e.offsetY=e.offsetY||e.layerY;var m={top:0,left:0},n={top:e.offsetY,left:e.offsetX},o=f.getPositions();a.on("mousemove touchmove",g),a.on("mouseup touchend touchcancel",h)}d.on("mousedown touchstart",g)}}}])}(),function(){angular.module("widgetGrid").directive("wgResizable",["gridUtil",function(a){return{restrict:"A",require:"wgWidget",link:{pre:function(b,c,d,e){var f=a.getTemplate("wg-resizable");if(f){var g=angular.element(f);c.append(g),e.innerCompile(g)}}}}}]);var a=0,b=1,c=2,d=3,e=4,f=5,g=6,h=7,i=42,j=42,k=1;angular.module("widgetGrid").directive("wgResizer",["$document",function(l){return{restrict:"A",require:"^wgGrid",link:function(m,n,o,p){function q(a,b){function c(c){function d(c){c.preventDefault(),c.touches&&(c.clientX=c.touches[0].clientX,c.clientY=c.touches[0].clientY);var d=c.clientX-r.left,e=c.clientY-r.top;a.up?(o.top=Math.min(Math.max(e-q.top,0),r.height-1)-n.top,o.top=Math.min(o.top,n.height-i)):a.down&&(o.bottom=n.bottom-Math.min(Math.max(e-q.bottom,0),r.height-1),o.bottom=Math.min(o.bottom,n.height-i)),a.left?(o.left=Math.min(Math.max(d-q.left,0),r.width-1)-n.left,o.left=Math.min(o.left,n.width-j)):a.right&&(o.right=n.right-Math.min(Math.max(d-q.right,0),r.width-1),o.right=Math.min(o.right,n.width-j)),b.css({top:o.top+"px",left:o.left+"px",bottom:o.bottom+"px",right:o.right+"px"})}function e(c){c.preventDefault(),l.off("mousemove touchmove",d),l.off("mouseup touchend touchcancel",e);var f,g,i,j=p.rasterizeCoords(n.left+o.left,n.top+o.top),k=p.rasterizeCoords(n.right-o.right,n.bottom-o.bottom),q={top:j.i,right:k.j,bottom:k.i,left:j.j},r={};if(a.up&&q.top<h.top)for(r.top=h.top;r.top>q.top;){for(f=!1,i=Math.max(h.left,q.left);i<=Math.min(h.right,q.right);i++)if(p.isPositionObstructed(r.top-1,i)){f=!0;break}if(f)break;r.top--}else if(a.down&&q.bottom>h.bottom)for(r.bottom=h.bottom;r.bottom<q.bottom;){for(f=!1,i=Math.max(h.left,q.left);i<=Math.min(h.right,q.right);i++)if(p.isPositionObstructed(r.bottom+1,i)){f=!0;break}if(f)break;r.bottom++}if(r.top=r.top||q.top,r.bottom=r.bottom||q.bottom,a.left&&q.left<h.left)for(r.left=h.left;r.left>q.left;){for(f=!1,g=r.top;g<=r.bottom;g++)if(p.isPositionObstructed(g,r.left-1)){f=!0;break}if(f)break;r.left--}else if(a.right&&q.right>h.right)for(r.right=h.right;r.right<q.right;){for(f=!1,g=r.top;g<=r.bottom;g++)if(p.isPositionObstructed(g,r.right+1)){f=!0;break}if(f)break;r.right++}r.right=r.right||q.right,r.left=r.left||q.left,m.setWidgetPosition(r),a.element.removeClass("dragging"),b.removeAttr("style")}c.preventDefault(),a.element.addClass("dragging");var f=b[0],g=f.parentElement,h={};h.top=m.widget.top,h.left=m.widget.left,h.bottom=h.top+m.widget.height-1,h.right=h.left+m.widget.width-1;var n={};n.top=g.offsetTop,n.left=g.offsetLeft,n.height=f.offsetHeight,n.width=f.offsetWidth,n.bottom=n.top+n.height,n.right=n.left+n.width,c.offsetX=c.offsetX||c.layerX,c.offsetY=c.offsetY||c.layerY;var o={top:k,right:k,bottom:k,left:k},q={top:c.offsetY+k,left:c.offsetX+k,bottom:c.offsetY-a.element[0].offsetHeight+k,right:c.offsetX-a.element[0].offsetWidth+k},r=p.getPositions();l.on("mousemove touchmove",d),l.on("mouseup touchend touchcancel",e)}a.element.on("mousedown touchstart",c)}for(var r=n.children(),s=[{up:!0,right:!1,down:!1,left:!1,element:angular.element(r[a])},{up:!1,right:!0,down:!1,left:!1,element:angular.element(r[b])},{up:!1,right:!1,down:!0,left:!1,element:angular.element(r[c])},{up:!1,right:!1,down:!1,left:!0,element:angular.element(r[d])},{up:!0,right:!1,down:!1,left:!0,element:angular.element(r[e])},{up:!0,right:!0,down:!1,left:!1,element:angular.element(r[f])},{up:!1,right:!0,down:!0,left:!1,element:angular.element(r[g])},{up:!1,right:!1,down:!0,left:!0,element:angular.element(r[h])}],t=0;t<s.length;t++)q(s[t],n)}}}])}(),function(){angular.module("widgetGrid").controller("wgWidgetController",["$scope","$compile","Widget",function(a,b){this.innerCompile=function(c){b(c)(a)}}]),angular.module("widgetGrid").directive("wgWidget",["$compile","Widget",function(a,b){return{scope:{position:"=",editable:"=?"},restrict:"AE",controller:"wgWidgetController",require:"^wgGrid",transclude:!0,templateUrl:"wg-widget",replace:!0,link:function(a,c,d,e){var f=a.position,g=new b(f);a.editable=!1,a.widget=g,a.getNodeIndex=function(){for(var a=0,b=c[0];null!==(b=b.previousElementSibling);)++a;return a},a.setWidgetPosition=function(a){g.setPosition(a),e.updateWidget(g),c.css(e.getWidgetStyle(g))},a.$on("rendering-finished",function(){c.css(e.getWidgetStyle(g))}),a.$on("$destroy",function(){e.removeWidget(g)}),e.addWidget(g)}}}])}(),function(){var a=4,b=4;angular.module("widgetGrid").factory("Grid",["gridUtil",function(c){var d=function(d){d=d||{},this.columns=parseInt(d.columns)||a,this.rows=parseInt(d.rows)||b,this.cellSize=c.computeCellSize(this.rows,this.columns),this.widgets=[]};return d.prototype.add=function(a){this.widgets.push(a)},d.prototype.remove=function(a){var b=this.widgets.indexOf(a);b>=0&&this.widgets.splice(b,1)},d.prototype.resize=function(a,b){b=parseInt(b)||0,a=parseInt(a)||0,(b>0&&a>0&&b!==this.columns||a!==this.rows)&&(this.columns=b,this.rows=a,this.cellSize=c.computeCellSize(this.rows,this.columns))},d}])}(),function(){angular.module("widgetGrid").factory("GridRendering",[function(){var a=function(a,b){this.grid=a||{widgets:[]},this.positions=b||{}};return a.prototype.rasterizeCoords=function(a,b,c,d){return a=Math.min(Math.max(a,0),c-1),b=Math.min(Math.max(b,0),d-1),{i:Math.floor(this.grid.rows/d*b)+1,j:Math.floor(this.grid.columns/c*a)+1}},a.prototype.getWidgetIdAt=function(a,b){for(var c in this.positions){var d=this.positions[c];if(d.top<=a&&a<=d.top+d.height-1&&d.left<=b&&b<=d.left+d.width-1)return c}return null},a.prototype.updateWidget=function(a){var b=this.positions[a.id];b.top=a.top||b.top,b.left=a.left||b.left,b.height=a.height||b.height,b.width=a.width||b.width},a.prototype.isObstructed=function(a,b,c){return 1>a||1>b||b>this.grid.columns?!0:c&&c.top<=a&&a<=c.bottom&&c.left<=b&&b<=c.right?!1:null!==this.getWidgetIdAt(a,b)},a.prototype.isAreaObstructed=function(a,b,c,d){for(var e=a.top,f=a.left,g=a.bottom||a.top+a.height-1,h=a.right||a.left+a.width-1,i=c?g:e,j=c?-1:1,k=(c?e:g)+j,l=d?h:f,m=d?-1:1,n=(d?f:h)+m,o=i;o!==k;o+=j)for(var p=l;p!==n;p+=m)if(this.isObstructed(o,p,b))return!0;return!1},a.prototype.getStyle=function(a){a=a.id||a;var b=this.positions[a];return b?{top:((b.top-1)*this.grid.cellSize.height).toString()+"%",height:(b.height*this.grid.cellSize.height).toString()+"%",left:((b.left-1)*this.grid.cellSize.width).toString()+"%",width:(b.width*this.grid.cellSize.width).toString()+"%"}:{display:"none"}},a}])}(),function(){var a=1,b=1,c=0,d=0;angular.module("widgetGrid").factory("Widget",["gridUtil",function(e){var f=function(f){this.id=e.getUID(),f=f||{},this.width=parseInt(f.width)||a,this.height=parseInt(f.height)||b,this.top=parseInt(f.top)||c,this.left=parseInt(f.left)||d,this.style={}};return f.prototype.setPosition=function(a){this.top=a.top||this.top,this.left=a.left||this.left,this.height=a.bottom-a.top+1||a.height||this.height,this.width=a.right-a.left+1||a.width||this.width},f}])}(),function(){angular.module("widgetGrid").service("gridRenderer",["GridRendering","gridUtil",function(a,b){return{render:function(c){for(var d=new a(c,{}),e=c&&c.widgets?c.widgets:[],f=b.sortWidgets(e),g=0;g<f.length;g++){var h=f[g],i={};h.width>c.columns?(i.width=c.columns,i.height=Math.max(Math.round(i.width/h.width*h.height),1)):(i.width=h.width,i.height=h.height);var j=d.isAreaObstructed({top:h.top,left:h.left,height:i.height,width:i.width});if(j)for(var k=1;j;){for(var l=1;l<=c.columns-i.width+1;l++)if(j=d.isAreaObstructed({top:k,left:l,height:i.height,width:i.width}),!j){i.top=k,i.left=l;break}k++}else i.top=h.top,i.left=h.left;d.positions[h.id]=i}return d}}}])}(),function(){angular.module("widgetGrid").service("gridUtil",["$templateCache",function(a){var b=1;return{getUID:function(){return(b++).toString()},sortWidgets:function(a){var b=[];if(!a.length||a.length<2)return a;for(var c,d,e,f=0;f<a.length;f++){c=a[f],e=!1;for(var g=0;g<b.length;g++)if(d=b[g],c.top<d.top||c.top===d.top&&c.left<d.left){b.splice(g,0,c),e=!0;break}e||b.push(c)}return b},roundDecimal:function(a){return Math.round(1e4*a)/1e4},computeCellSize:function(a,b){return{height:a>=1?this.roundDecimal(100/a):0,width:b>=1?this.roundDecimal(100/b):0}},getTemplate:function(b){var c=a.get(b);return c?c:null},getPathIterator:function(a,b){var c=a.top-b.top,d=a.left-b.left,e=Math.max(Math.abs(c),Math.abs(d)),f=0,g=null,h={top:b.top,left:b.left};return{hasNext:function(){return null!==h},next:function(){if(g=h,e>f){f++;var a=Math.round(f/e*c),i=Math.round(f/e*d);h={top:b.top+a,left:b.left+i}}else h=null;return g}}}}}])}(),angular.module("widgetGrid").run(["$templateCache",function(a){"use strict";a.put("wg-grid","<div ng-app=widgetGrid ng-strict-di class=wg-grid><div class=wg-grid-overlay></div><div class=wg-grid-widgets ng-transclude></div></div>"),a.put("wg-movable",'<div wg-mover ng-show=editable class="wg-widget-edit wg-widget-edit-move"></div>'),a.put("wg-resizable",'<div wg-resizer ng-show=editable class="wg-widget-edit wg-widget-edit-resize"><div class="wg-resize wg-resize-axis wg-resize-n"></div><div class="wg-resize wg-resize-axis wg-resize-e"></div><div class="wg-resize wg-resize-axis wg-resize-s"></div><div class="wg-resize wg-resize-axis wg-resize-w"></div><div class="wg-resize wg-resize-diag wg-resize-nw"></div><div class="wg-resize wg-resize-diag wg-resize-ne"></div><div class="wg-resize wg-resize-diag wg-resize-se"></div><div class="wg-resize wg-resize-diag wg-resize-sw"></div></div>'),a.put("wg-widget",'<div class=wg-widget ng-class="{ editable: editable }"><div class=wg-widget-content ng-transclude></div></div>')}]);
//# sourceMappingURL=angular-widget-grid.min.js.map